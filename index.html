<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<title>Riff Playground</title>
<link rel="stylesheet" href="lib/codemirror.css" />

<!-- Import custom stylesheet after CodeMirror's to override defaults -->
<link rel="stylesheet" href="style.css" />

<link rel="stylesheet" href="theme/3024-day.css">
<link rel="stylesheet" href="theme/3024-night.css">
<link rel="stylesheet" href="theme/abcdef.css">
<link rel="stylesheet" href="theme/ayu-dark.css">
<link rel="stylesheet" href="theme/ayu-mirage.css">
<link rel="stylesheet" href="theme/base16-dark.css">
<link rel="stylesheet" href="theme/bespin.css">
<link rel="stylesheet" href="theme/base16-light.css">
<link rel="stylesheet" href="theme/blackboard.css">
<link rel="stylesheet" href="theme/cobalt.css">
<link rel="stylesheet" href="theme/colorforth.css">
<link rel="stylesheet" href="theme/dracula.css">
<link rel="stylesheet" href="theme/duotone-dark.css">
<link rel="stylesheet" href="theme/duotone-light.css">
<link rel="stylesheet" href="theme/erlang-dark.css">
<link rel="stylesheet" href="theme/gruvbox-dark.css">
<link rel="stylesheet" href="theme/hopscotch.css">
<link rel="stylesheet" href="theme/icecoder.css">
<link rel="stylesheet" href="theme/isotope.css">
<link rel="stylesheet" href="theme/lesser-dark.css">
<link rel="stylesheet" href="theme/lucario.css">
<link rel="stylesheet" href="theme/material.css">
<link rel="stylesheet" href="theme/material-darker.css">
<link rel="stylesheet" href="theme/material-palenight.css">
<link rel="stylesheet" href="theme/material-ocean.css">
<link rel="stylesheet" href="theme/mbo.css">
<link rel="stylesheet" href="theme/mdn-like.css">
<link rel="stylesheet" href="theme/midnight.css">
<link rel="stylesheet" href="theme/monokai.css">
<link rel="stylesheet" href="theme/moxer.css">
<link rel="stylesheet" href="theme/neo.css">
<link rel="stylesheet" href="theme/nord.css">
<link rel="stylesheet" href="theme/oceanic-next.css">
<link rel="stylesheet" href="theme/panda-syntax.css">
<link rel="stylesheet" href="theme/paraiso-dark.css">
<link rel="stylesheet" href="theme/paraiso-light.css">
<link rel="stylesheet" href="theme/pastel-on-dark.css">
<link rel="stylesheet" href="theme/railscasts.css">
<link rel="stylesheet" href="theme/rubyblue.css">
<link rel="stylesheet" href="theme/seti.css">
<link rel="stylesheet" href="theme/the-matrix.css">
<link rel="stylesheet" href="theme/tomorrow-night-bright.css">
<link rel="stylesheet" href="theme/tomorrow-night-eighties.css">
<link rel="stylesheet" href="theme/twilight.css">
<link rel="stylesheet" href="theme/vibrant-ink.css">
<link rel="stylesheet" href="theme/yeti.css">
<link rel="stylesheet" href="theme/darcula.css">
<link rel="stylesheet" href="theme/yonce.css">
<link rel="stylesheet" href="theme/zenburn.css">
<script src="lib/codemirror.js"></script>
<script src="lib/simple.js"></script>
<script src="lib/riff.js"></script>
<script src="lib/riff-samples.js"></script>
</head>
<body>
<div class="main">
    <div class='menu'>
    <div class="menu-left">
        <a href="https://riff.cx">
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 189 129" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1,0,0,1,-591.196,-299.999)">
        <g transform="matrix(1.62991,0,0,1,0,0)">
            <g transform="matrix(0.613529,0,0,1,354.168,-55.1031)">
                <path d="M104.986,381.749C104.346,382.612 104,383.657 104,384.731C104,396.283 104,464.871 104,480.118C104,480.914 104.316,481.677 104.879,482.24C105.442,482.802 106.206,483.118 107.002,483.118C111.595,483.115 120.179,483.109 123.462,483.107C124.304,483.106 125.108,482.751 125.676,482.129C127.181,480.479 130.294,477.067 132.653,474.481C133.187,473.896 133.325,473.052 133.007,472.328C132.688,471.603 131.972,471.135 131.18,471.133C129.648,471.13 128.013,471.126 126.78,471.124C125.677,471.121 124.784,470.227 124.784,469.124C124.784,459.212 124.784,415.373 124.784,405.656C124.784,404.586 125.626,403.706 126.694,403.658C127.893,403.604 129.405,403.536 130.455,403.488C131.223,403.454 131.904,402.981 132.205,402.273C133.292,399.715 135.923,393.527 137.463,389.903C137.725,389.287 137.662,388.58 137.293,388.021C136.925,387.462 136.301,387.124 135.631,387.121C132.947,387.109 129.094,387.092 126.776,387.082C125.674,387.078 124.784,386.184 124.784,385.082C124.784,382.873 124.784,379.329 124.784,377.118C124.784,376.014 125.679,375.119 126.782,375.118C130.904,375.114 140.276,375.105 144,375.101C144.983,375.1 145.903,374.618 146.463,373.811C148.619,370.702 154.155,362.72 157.249,358.257C157.673,357.646 157.723,356.85 157.378,356.191C157.033,355.531 156.351,355.118 155.607,355.118C148.472,355.114 133.298,355.106 127.3,355.103C125.717,355.102 124.228,355.851 123.284,357.121C119.264,362.531 108.332,377.246 104.986,381.749Z"/>
            </g>
        </g>
        <g transform="matrix(1.62991,0,0,1,0,0)">
            <g transform="matrix(0.613529,0,0,1,380.788,-54.7283)">
                <path d="M104.986,381.749C104.346,382.612 104,383.657 104,384.731C104,396.283 104,464.871 104,480.118C104,480.914 104.316,481.677 104.879,482.24C105.442,482.802 106.206,483.118 107.002,483.118C111.595,483.115 120.179,483.109 123.462,483.107C124.304,483.106 125.108,482.751 125.676,482.129C127.181,480.479 130.294,477.067 132.653,474.481C133.187,473.896 133.325,473.052 133.007,472.328C132.688,471.603 131.972,471.135 131.18,471.133C129.648,471.13 128.013,471.126 126.78,471.124C125.677,471.121 124.784,470.227 124.784,469.124C124.784,459.212 124.784,415.373 124.784,405.656C124.784,404.586 125.626,403.706 126.694,403.658C127.893,403.604 129.405,403.536 130.455,403.488C131.223,403.454 131.904,402.981 132.205,402.273C133.292,399.715 135.923,393.527 137.463,389.903C137.725,389.287 137.662,388.58 137.293,388.021C136.925,387.462 136.301,387.124 135.631,387.121C132.947,387.109 129.094,387.092 126.776,387.082C125.674,387.078 124.784,386.184 124.784,385.082C124.784,382.873 124.784,379.329 124.784,377.118C124.784,376.014 125.679,375.119 126.782,375.118C130.904,375.114 140.276,375.105 144,375.101C144.983,375.1 145.903,374.618 146.463,373.811C148.619,370.702 154.155,362.72 157.249,358.257C157.673,357.646 157.723,356.85 157.378,356.191C157.033,355.531 156.351,355.118 155.607,355.118C148.472,355.114 133.298,355.106 127.3,355.103C125.717,355.102 124.228,355.851 123.284,357.121C119.264,362.531 108.332,377.246 104.986,381.749Z"/>
            </g>
        </g>
        <g transform="matrix(1.62991,0,0,1,0,0)">
            <g transform="matrix(0.613529,0,0,1,231.853,-50.6645)">
                <path d="M275.649,408.986C275.649,407.629 276.201,406.33 277.178,405.388C280.505,402.179 288.469,394.497 293.045,390.083C293.622,389.526 294.477,389.368 295.215,389.682C295.954,389.995 296.433,390.72 296.433,391.522C296.433,407.915 296.433,462.219 296.433,475.599C296.433,477.256 295.091,478.599 293.434,478.599C289.489,478.601 282.596,478.603 278.649,478.604C277.854,478.605 277.09,478.289 276.527,477.726C275.965,477.163 275.648,476.4 275.648,475.604C275.649,463.606 275.649,419.239 275.649,408.986Z"/>
            </g>
        </g>
        <g transform="matrix(1.62991,0,0,1,0,0)">
            <g transform="matrix(0.613529,0,0,1,298.955,-28.1897)">
                <path d="M105.147,373.971C104.359,374.88 103.925,376.043 103.925,377.246C103.925,387.815 103.925,440.164 103.925,453.298C103.925,454.952 105.263,456.294 106.917,456.298C111.138,456.308 118.741,456.327 122.492,456.336C123.904,456.34 125.252,455.746 126.202,454.703C127.84,452.904 130.513,449.968 132.594,447.682C133.127,447.097 133.265,446.254 132.947,445.53C132.629,444.807 131.914,444.338 131.124,444.335C129.584,444.329 127.94,444.322 126.701,444.317C125.6,444.312 124.709,443.418 124.709,442.317C124.709,431.858 124.708,383.367 124.708,372.967C124.708,371.876 125.583,370.986 126.675,370.968C129.701,370.918 135.468,370.822 138.533,370.772C139.069,370.763 139.586,370.97 139.968,371.346C140.351,371.722 140.566,372.235 140.566,372.771C140.566,376.335 140.566,383.795 140.566,388.694C140.566,389.495 141.044,390.219 141.781,390.533C142.518,390.848 143.371,390.692 143.95,390.138C148.363,385.909 155.828,378.756 158.426,376.266C159.017,375.7 159.35,374.918 159.35,374.1C159.35,370.407 159.35,359.664 159.35,354.382C159.35,353.586 159.034,352.823 158.471,352.26C157.908,351.698 157.144,351.382 156.348,351.382C149.539,351.387 133.047,351.399 126.99,351.403C125.541,351.404 124.164,352.034 123.216,353.128C119.291,357.655 108.745,369.821 105.147,373.971Z"/>
            </g>
        </g>
        <g transform="matrix(1.62991,0,0,1,0,0)">
            <g transform="matrix(0.613529,0,0,1,261.104,-3.77932)">
                <path d="M250.189,309.093C250.189,308.285 249.702,307.556 248.956,307.246C248.21,306.936 247.351,307.105 246.778,307.675C241.68,312.747 232.411,321.969 229.993,324.374C229.616,324.75 229.404,325.26 229.404,325.792C229.404,328.654 229.404,338.242 229.404,344.15C229.404,344.958 229.89,345.686 230.636,345.996C231.382,346.307 232.242,346.137 232.815,345.567C237.913,340.495 247.182,331.273 249.599,328.868C249.976,328.493 250.189,327.982 250.189,327.45C250.189,324.589 250.189,315 250.189,309.093Z"/>
            </g>
        </g>
    </g>
</svg></a>
    </div>
    <div class="menu-right">
        <div class='playground-controls'>
            <button onclick="riffExec(1);">Execute</button>
            <button onclick="riffExec(0);">Disassemble</button>
        </div>
        <div class='playground-dropdown'>
            <select class='playground-dropdown' onchange='riffLoadSample(this.value);'>
                <option selected disabled>Sample Programs</option>
                <option value='hello'>Hello, World!</option>
                <option value='factorial'>Factorial</option>
                <option value='fibonacci'>Fibonacci</option>
            </select>
        </div>
        <div class='playground-dropdown'>
            <select class='playground-dropdown' onchange='changeTheme(this.value);'>
                <option selected disabled>Playground Theme</option>
                <option value='default'>default</option>
                <option value='3024-day'>3024-day</option>
                <option value='3024-night'>3024-night</option>
                <option value='abcdef'>abcdef</option>
                <option value='ayu-dark'>ayu-dark</option>
                <option value='ayu-mirage'>ayu-mirage</option>
                <option value='base16-dark'>base16-dark</option>
                <option value='base16-light'>base16-light</option>
                <option value='bespin'>bespin</option>
                <option value='blackboard'>blackboard</option>
                <option value='cobalt'>cobalt</option>
                <option value='colorforth'>colorforth</option>
                <option value='darcula'>darcula</option>
                <option value='dracula'>dracula</option>
                <option value='duotone-dark'>duotone-dark</option>
                <option value='duotone-light'>duotone-light</option>
                <option value='erlang-dark'>erlang-dark</option>
                <option value='gruvbox-dark'>gruvbox-dark</option>
                <option value='hopscotch'>hopscotch</option>
                <option value='icecoder'>icecoder</option>
                <option value='isotope'>isotope</option>
                <option value='lesser-dark'>lesser-dark</option>
                <option value='lucario'>lucario</option>
                <option value='material'>material</option>
                <option value='material-darker'>material-darker</option>
                <option value='material-palenight'>material-palenight</option>
                <option value='material-ocean'>material-ocean</option>
                <option value='mbo'>mbo</option>
                <option value='mdn-like'>mdn-like</option>
                <option value='midnight'>midnight</option>
                <option value='monokai'>monokai</option>
                <option value='moxer'>moxer</option>
                <option value='neo'>neo</option>
                <option value='nord'>nord</option>
                <option value='oceanic-next'>oceanic-next</option>
                <option value='panda-syntax'>panda-syntax</option>
                <option value='paraiso-dark'>paraiso-dark</option>
                <option value='paraiso-light'>paraiso-light</option>
                <option value='pastel-on-dark'>pastel-on-dark</option>
                <option value='railscasts'>railscasts</option>
                <option value='rubyblue'>rubyblue</option>
                <option value='seti'>seti</option>
                <option value='the-matrix'>the-matrix</option>
                <option value='tomorrow-night-bright'>tmrw-night-bright</option>
                <option value='tomorrow-night-eighties'>tmrw-night-80s</option>
                <option value='twilight'>twilight</option>
                <option value='vibrant-ink'>vibrant-ink</option>
                <option value='yeti'>yeti</option>
                <option value='yonce'>yonce</option>
                <option value='zenburn'>zenburn</option>

            </select>
        </div>
    </div>
    </div>
    <div class='playground'>
        <div class='playground-left'>
            <div class='playground-header'><div>Input</div></div>
            <div class='playground-input'>
                <textarea id='input'
                          autofocus
                          autocomplete='off'
                          autocapitalize='off'
                          spellcheck='false'>
// This code is editable!
"Hello, world!"</textarea>
            </div>
        </div>
        <div class='playground-right'>
            <div class='playground-header'>
                <div id='output-title'>Output</div>
                <div id='metrics'></div>
            </div>
            <div class='playground-output'>
                <textarea id="output" readonly></textarea>
            </div>
        </div>
    </div>
</div>
<script type='text/javascript'>

    var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
            var element = document.getElementById('output');

            // Clear output textarea
            if (element)
                element.value = '';
            return function(text) {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                console.log(text);
                if (element) {
                    element.value += text + "\n";
                    element.scrollTop = element.scrollHeight; // focus on bottom
                }
            };
        })(),
        printErr: function(text) {
            if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
            console.error(text);

            // Custom error handling
            document.getElementById('output-title').innerHTML =
                '<span style="color:red";>Error</span>';
            document.getElementById('output').value = text;
            cmOutput.setValue(document.getElementById('output').value);
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
            this.totalDependencies = Math.max(this.totalDependencies, left);
        }
    };
    // TODO Riff interpreter error handling
    window.onerror = function(event) {
    };
</script>
<script type='text/javascript'>

    // Initialize the CodeMirror input textarea
    var cmInput =
    CodeMirror.fromTextArea(document.getElementById('input'), {
        lineNumbers:    true,
        spellcheck:     false,
        autocorrect:    false,
        autocapitalize: false,
        autofocus:      true,
        matchBrackets:  true,

        // lib/riff.js: CodeMirror.defineSimpleMode()
        mode:           'riff',
    });

    var cmOutput =
    CodeMirror.fromTextArea(document.getElementById('output'), {
        lineNumbers:    false,
        lineWrapping:   false,
        spellcheck:     false,
        autocorrect:    false,
        autocapitalize: false,
        autofocus:      false,
        mode:           'null',
        readOnly:       'nocursor',
    });

    // Set theme as default
    // Changes the CSS vars `--color-fg` and `--color-bg`
    changeTheme('default');

    // Riff code execution
    function riffExec(exec) {

        // Clear the output textarea
        document.getElementById('output').value = '';

        // Grab the program from the CodeMirror editor
        var inputProgram = cmInput.getValue();

        // Print the input program to the console
        console.log(inputProgram);
        var start = Date.now();

        // Invoke the Riff interpreter with the input program
        // This calls a special wasm() function in riff.c
        Module.ccall('wasm_main', 'number', ['number', 'string'],
            [exec, inputProgram]);
        cmOutput.setValue(document.getElementById('output').value);
        var execTime = Date.now() - start;
        console.log('Runtime: ' + (execTime/1000));
        document.getElementById('metrics').innerHTML =
            'riff 0.1a / ~' + (execTime / 1000) + 's';
        if (exec == 0)
            document.getElementById('output-title').innerHTML =
                'Disassembly';
        else
            document.getElementById('output-title').innerHTML =
                'Output';
    }

    function riffLoadSample(sample) {

        // Clear the output textarea
        document.getElementById('output').value = '';

        var s = riffSamples[sample];
        if (s != null)
            cmInput.setValue(s);
    }

    function changeTheme(theme) {
        cmInput.setOption('theme', theme);
        cmOutput.setOption('theme', theme);
        var css = '.cm-s-' + theme;
        var styles = window.getComputedStyle(document.querySelector(css));
        document.documentElement.style.setProperty('--color-fg', styles.color);
        document.documentElement.style.setProperty('--color-bg', styles.backgroundColor);
    }
</script>
<script async type='text/javascript' src='riff.js'></script>
</body>
</html>
